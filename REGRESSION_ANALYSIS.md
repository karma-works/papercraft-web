# Regression Analysis: Texture Export Fixes

## Overview
The user reported that SVG and PDF texture exports are now working, but requested an investigation into "where the fix was lost" based on git history.

## Git History Analysis

### 1. Texture Export Feature Introduction
- **Commit `16af706` (Jan 20)** ("fix the pdf export"):
  - Introduced `generate_pdf_page_ops`.
  - **Status:** NO texture export logic. It explicitly rendered faces with solid colors (`rg` operator for fill, no `Do` operator for images).
  - **Conclusion:** Texture export was NOT working (or even implemented) in the PDF path as of Jan 20.

- **Commit `3a7598f` (Jan 4)** (Initial vector export):
  - **Status:** NO texture export logic. Only solid colors.

- **Commit `38b000d` (Today)** ("Fix texture transform matrix calculation for SVG export"):
  - **Status:** This commit INTRODUCED the texture export logic for both SVG and PDF (calculating UV matrices, embedding images).
  - **Issue:** It introduced the `.transpose()` bug which caused textures to be misplaced/scaled incorrectly.

### 2. The "Width=1" Issue
- `export3.svg` and `export.svg` were observed to have `width="1" height="1"` for texture images.
- This incorrect width was likely generated by an intermediate state or a specific implementation detail in `38b000d` (or a local uncommitted version) where the image dimensions were not correctly retrieved or passed.
- **Fix:** In `38b000d` (as committed), the code uses `pixbuf.width()`, which should be correct. If `width="1"` persisted, it suggests the binary running was either outdated or the `pixbuf` loaded a 1x1 placeholder.

### 3. The "Empty Pages" Regression (PDF)
- **Root Cause:** Mismatch between island layout (horizontal, >2 columns) and `page_cols` setting (2).
- **Behavior:** Islands visually in "Column 2" were assigned to Page 2. With `page_cols=2`, Page 2 is at (Row 1, Col 0). Islands were at (Row 0, Col 2).
- **Result:** Relative coordinate `(Row 0 - Row 1)` results in negative Y (off-page/empty).
- **Fix:** Commit `dbf85f9` introduces auto-detection of `page_cols` to ensure the grid covers all islands horizontally.

### 4. Git Worktrees
- `textures` (Current): Contains all fixes (`38b000d`, `7f4dd2f`, `dbf85f9`).
- `ui-bugfixes` (`18f099c`): This branch appears to be based on `textures` (specifically `dbf85f9`) and adds "fix compile errors". It contains the fixes.
- `textures-gemini` (`16af706`): This is an older state (Jan 20) with NO texture support.

## Conclusion
The texture export functionality was **not lost** from a previous working state in the examined history. Instead, it appears to have been **unimplemented** in the backend until the recent commits on the `textures` branch. The "bugs" (misplaced textures, empty pages) were issues in the initial implementation of this feature, which have now been resolved.
